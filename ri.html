<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerar Tabela de Dados</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    <style>
        .container {
            margin-top: 30px;
        }
        .table-container {
            margin-top: 20px;
        }
        textarea {
            width: 100%;
            height: 300px;
        }
        .btn-copy {
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1 class="text-center">Gerar Tabela de Dados</h1>

    <div class="mb-3">
        <label for="inputText" class="form-label">Insira os dados:</label>
        <textarea id="inputText" class="form-control" placeholder="Cole os dados aqui"></textarea>
    </div>

    <button id="generateTable" class="btn btn-primary w-100">Gerar Tabela</button>

    <div class="table-container" id="tableContainer" style="display:none;">
        <h3 class="mt-4">Tabela Gerada</h3>
        <table class="table table-bordered" id="dataTable">
            <thead>
                <tr>
                    <th>Modalidade</th>
                    <th>Empresa</th>
                    <th>Origem</th>
                    <th>Destino</th>
                    <th>Data</th>
                    <th>Hora</th>
                    <th>Motorista</th>
                    <th>Placa</th>
                    <th>Telefone</th>
                    <th>Agente 1</th>
                    <th>Telefone Agente 1</th>
                    <th>Agente 2</th>
                    <th>Telefone Agente 2</th>
                    <th>Veículo Utilizado</th>
                    <th>Placa do Veículo</th>
                    <th>Valor Pedágio</th>
                    <th>Km Inicial</th>
                    <th>Km Final</th>
                    <th>Total de Km</th>
                    <th>Horário Local Agente</th>
                    <th>Início Operação</th>
                    <th>Término Operação</th>
                    <th>Total Horas Operação</th>
                    <th>Total Horas Agente</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <!-- Dados gerados aqui -->
            </tbody>
        </table>

        <button class="btn btn-success btn-copy" id="copyButton">Copiar para Excel</button>
    </div>
</div>

<script>
    function processTextData(text) {
        const regex = /(ESCOLTA|PRESERVAÇÃO)[\s\S]+?(?:[0-9]{2}\/[0-9]{2})/g;
        const matches = text.match(regex) || [];
        const data = [];

        matches.forEach(match => {
            const row = {};
            const lines = match.split("\n");

            // Modalidade e Empresa
            const [modalidade, empresa] = lines[0].split(" ").slice(0, 2);

            row.modalidade = modalidade;
            row.empresa = empresa;

            // Dados adicionais
            lines.forEach(line => {
                if (line.includes("Origem:")) {
                    row.origem = line.split(":")[1].trim();
                }
                if (line.includes("Destino:")) {
                    row.destino = line.split(":")[1].trim();
                }
                if (line.includes("Data:")) {
                    row.data = line.split(":")[1].trim();
                }
                if (line.includes("Hora:")) {
                    row.hora = line.split(":")[1].trim();
                }
                if (line.includes("Motorista:")) {
                    row.motorista = line.split(":")[1].trim();
                }
                if (line.includes("Placa:") && !line.includes("Placa do veiculo")) {
                    row.placa = line.split(":")[1].trim();
                }
                if (line.includes("Telefone:")) {
                    row.telefone = line.split(":")[1].trim();
                }
                if (line.includes("Agente:")) {
                    row.agente1 = line.split(":")[1].trim();
                }
                if (line.includes("Telefones do agente:")) {
                    row.telefoneAgente1 = line.split(":")[1].trim();
                }
                if (line.includes("Veículo utilizado:")) {
                    row.veiculoUtilizado = line.split(":")[1].trim();
                }
                if (line.includes("Placa") && line.includes("Veículo utilizado:")) {
                    row.placaVeiculo = line.split(":")[1].trim();
                }
                if (line.includes("Valor do pedágio:")) {
                    row.valorPedagio = line.split(":")[1].trim();
                }
                if (line.includes("Km inicial:")) {
                    row.kmInicial = line.split(":")[1].trim();
                }
                if (line.includes("Km final:")) {
                    row.kmFinal = line.split(":")[1].trim();
                }
                if (line.includes("Total de km:")) {
                    row.totalKm = line.split(":")[1].trim();
                }
                if (line.includes("Horário local do agente:")) {
                    row.horarioLocalAgente = line.split(":")[1].trim();
                }
                if (line.includes("Horário de início da operação:")) {
                    row.horarioInicioOperacao = line.split(":")[1].trim();
                }
                if (line.includes("Horário de término da operação:")) {
                    row.horarioTerminoOperacao = line.split(":")[1].trim();
                }
                if (line.includes("Total de horas da operação:")) {
                    row.totalHorasOperacao = line.split(":")[1].trim();
                }
                if (line.includes("Total de horas do agente:")) {
                    row.totalHorasAgente = line.split(":")[1].trim();
                }
                if (line.includes("Agente 2:")) {
                    row.agente2 = line.split(":")[1].trim();
                }
                if (line.includes("Telefones do agente 2:")) {
                    row.telefoneAgente2 = line.split(":")[1].trim();
                }
            });

            // Calcular total de km
            const kmInicial = parseInt(row.kmInicial, 10);
            const kmFinal = parseInt(row.kmFinal, 10);
            if (!isNaN(kmInicial) && !isNaN(kmFinal)) {
                row.totalKm = kmFinal - kmInicial;
            }

            // Se Agente 2 não estiver presente, deixar em branco
            row.agente2 = row.agente2 || '';
            row.telefoneAgente2 = row.telefoneAgente2 || '';

            data.push(row);
        });

        return data;
    }

    function generateTable(data) {
        const tableBody = document.getElementById("tableBody");
        tableBody.innerHTML = '';

        data.forEach(row => {
            const tr = document.createElement("tr");
            Object.values(row).forEach(value => {
                const td = document.createElement("td");
                td.textContent = value;
                tr.appendChild(td);
            });
            tableBody.appendChild(tr);
        });
    }

    function copyTableToClipboard() {
        const table = document.getElementById("dataTable");
        const range = document.createRange();
        range.selectNode(table);
        window.getSelection().removeAllRanges();
        window.getSelection().addRange(range);
        document.execCommand('copy');
    }

    document.getElementById("generateTable").addEventListener("click", function () {
        const inputText = document.getElementById("inputText").value.trim();
        if (inputText) {
            const data = processTextData(inputText);
            generateTable(data);
            document.getElementById("tableContainer").style.display = "block";
        }
    });

    document.getElementById("copyButton").addEventListener("click", function () {
        copyTableToClipboard();
        alert("Tabela copiada! Agora você pode colar no Excel.");
    });
</script>

</body>
</html>
