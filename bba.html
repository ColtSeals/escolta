<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Gerador de Tabela</title>
    <style>
        .form-container {
            margin: 20px;
        }
        textarea {
            width: 100%;
            height: 300px;
            margin-bottom: 10px;
        }
        .result-table {
            margin: 20px;
            display: none;
        }
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        button {
            margin: 5px;
            padding: 5px 10px;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <textarea id="inputText" placeholder="Cole aqui o texto no formato especificado"></textarea><br>
        <button onclick="generateTable()">Gerar Excel</button>
    </div>

    <div class="result-table" id="result">
        <button onclick="copyData()">Copiar Dados</button>
        <table id="resultTable">
            <thead>
                <tr>
                    <th>Nome da Empresa</th><th>Data</th><th>Hora</th>
                    <th>Origem</th><th>Destino</th><th>Local</th>
                    <th>Motorista</th><th>Telefone</th><th>Placa do Cavalo</th>
                    <th>Placa da Carreta</th><th>Motivo</th><th>Transportadora</th>
                    <th>Agente 1</th><th>Telefone do Agente 1</th><th>Veículo Utilizado</th><th>Placa</th>
                    <th>Agente 2</th><th>Telefone do Agente 2</th><th>Veículo Utilizado</th><th>Placa</th>
                    <th>Agente 3</th><th>Telefone do Agente 3</th><th>Veículo Utilizado</th><th>Placa</th>
                    <th>Valor do Pedágio</th><th>Km Inicial</th><th>Km Final</th><th>Total de Km</th>
                    <th>Horário Local do Agente</th><th>Horário de Início</th><th>Horário de Término</th>
                    <th>Total de Horas da Operação</th><th>Total de Horas do Agente</th><th>Manifesto</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <script>
        function generateTable() {
            const inputText = document.getElementById('inputText').value;
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';

            const fieldMap = {
                '*Nome da Empresa:*': 'Nome da Empresa',
                '*Data:*': 'Data',
                '*Hora:*': 'Hora',
                '*Origem:*': 'Origem',
                '*Destino:*': 'Destino',
                '*Local:*': 'Local',
                '*Motorista:*': 'Motorista',
                '*Telefone:*': 'Telefone',
                '*Placa do Cavalo:*': 'Placa do Cavalo',
                '*Placa da Carreta:*': 'Placa da Carreta',
                '*Motivo:*': 'Motivo',
                '*Transportadora:*': 'Transportadora',
                '*Agente 1:*': 'Agente 1',
                '*Telefone do Agente 1:*': 'Telefone do Agente 1',
                '*Veículo Utilizado:*': 'Veículo Utilizado',
                '*Placa:*': 'Placa',
                '*Agente 2:*': 'Agente 2',
                '*Telefone do Agente 2:*': 'Telefone do Agente 2',
                '*Agente 3:*': 'Agente 3',
                '*Telefone do Agente 3:*': 'Telefone do Agente 3',
                '*Valor do Pedágio:*': 'Valor do Pedágio',
                '*Km Inicial:*': 'Km Inicial',
                '*Km Final:*': 'Km Final',
                '*Total de Km:*': 'Total de Km',
                '*Horário Local do Agente:*': 'Horário Local do Agente',
                '*Horário de Início da Operação:*': 'Horário de Início',
                '*Horário de Término da Operação:*': 'Horário de Término',
                '*Total de Horas da Operação:*': 'Total de Horas da Operação',
                '*Total de Horas do Agente:*': 'Total de Horas do Agente',
                '*Manifesto:*': 'Manifesto'
            };

            const lines = inputText.split('\n');
            let currentData = {};
            let agentCount = 1;

            lines.forEach(line => {
                line = line.trim();
                if (!line) return;

                for (const [inputKey, outputKey] of Object.entries(fieldMap)) {
                    if (line.startsWith(inputKey)) {
                        const value = line.replace(inputKey, '').trim();
                        
                        // Reset para novo registro quando encontrar Nome da Empresa
                        if (inputKey === '*Nome da Empresa:*' && Object.keys(currentData).length > 0) {
                            addRowToTable(tableBody, currentData);
                            currentData = {};
                            agentCount = 1;
                        }

                        // Lógica para múltiplos agentes
                        if (inputKey === '*Agente ' + agentCount + ':*' && value) {
                            currentData[outputKey] = value;
                            agentCount++;
                        } else if (inputKey.includes('Agente') && !inputKey.includes(agentCount)) {
                            // Ignora agentes fora da sequência
                            continue;
                        } else {
                            currentData[outputKey] = value;
                        }
                        break;
                    }
                }
            });

            // Adiciona o último registro
            if (Object.keys(currentData).length > 0) {
                addRowToTable(tableBody, currentData);
            }

            document.getElementById('result').style.display = 'block';
        }

        function addRowToTable(tableBody, data) {
            const row = document.createElement('tr');
            const fields = [
                'Nome da Empresa', 'Data', 'Hora',
                'Origem', 'Destino', 'Local',
                'Motorista', 'Telefone', 'Placa do Cavalo',
                'Placa da Carreta', 'Motivo', 'Transportadora',
                'Agente 1', 'Telefone do Agente 1', 'Veículo Utilizado', 'Placa',
                'Agente 2', 'Telefone do Agente 2', 'Veículo Utilizado', 'Placa',
                'Agente 3', 'Telefone do Agente 3', 'Veículo Utilizado', 'Placa',
                'Valor do Pedágio', 'Km Inicial', 'Km Final', 'Total de Km',
                'Horário Local do Agente', 'Horário de Início',
                'Horário de Término', 'Total de Horas da Operação',
                'Total de Horas do Agente', 'Manifesto'
            ];

            let agentVehicleCount = 1;
            fields.forEach(field => {
                const cell = document.createElement('td');
                if (field === 'Veículo Utilizado' || field === 'Placa') {
                    // Para o primeiro agente
                    if (agentVehicleCount === 1 && data['Agente 1'] && !data['Veículo Utilizado']) {
                        cell.textContent = data[field] || '';
                    }
                    // Para o segundo agente
                    else if (agentVehicleCount === 2 && data['Agente 2']) {
                        cell.textContent = data[field] || '';
                        agentVehicleCount++;
                    }
                    // Para o terceiro agente
                    else if (agentVehicleCount === 3 && data['Agente 3']) {
                        cell.textContent = data[field] || '';
                        agentVehicleCount++;
                    }
                    else {
                        cell.textContent = '';
                    }
                } else {
                    cell.textContent = data[field] || '';
                }
                row.appendChild(cell);
            });

            tableBody.appendChild(row);
        }

        function copyData() {
            const tableBody = document.getElementById('tableBody');
            const rows = tableBody.getElementsByTagName('tr');
            let text = '';
            
            for (let row of rows) {
                const cells = row.getElementsByTagName('td');
                let rowText = '';
                for (let cell of cells) {
                    rowText += cell.textContent + '\t';
                }
                text += rowText.trim() + '\n';
            }
            
            navigator.clipboard.writeText(text.trim())
                .then(() => alert('Dados copiados para a área de transferência!'))
                .catch(err => alert('Erro ao copiar: ' + err));
        }
    </script>
</body>
</html>
