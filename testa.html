<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Tabela para Excel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 10px;
            max-width: 100%;
            overflow-x: auto;
        }
        textarea {
            width: 100%;
            height: 200px;
            margin-bottom: 10px;
        }
        button {
            padding: 10px;
            margin: 5px;
            width: 100%;
            max-width: 200px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            font-size: 14px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        @media (max-width: 600px) {
            table {
                font-size: 12px;
            }
            th, td {
                padding: 5px;
            }
        }
    </style>
</head>
<body>
    <h2>Gerador de Tabela</h2>
    <textarea id="inputText" placeholder="Cole os exemplos aqui..."></textarea>
    <button onclick="generateTable()">Gerar Tabela</button>
    <button onclick="copyToClipboard()">Copiar para Excel</button>
    <div id="tableContainer"></div>

    <script>
        function generateTable() {
            const input = document.getElementById('inputText').value;
            const examples = input.split('\n\n');
            let tableHTML = '<table><thead><tr>' +
                '<th>MODALIDADE</th><th>EMPRESA</th><th>ORIGEM</th><th>DESTINO</th><th>DATA</th><th>HORARIO</th>' +
                '<th>MOTORISTA</th><th>PLACA</th><th>TELEFONE</th><th>AGENTE 1</th><th>TELEFONE DO AGENTE 1</th>' +
                '<th>AGENTE 2</th><th>TELEFONE DO AGENTE 2</th><th>VEICULO UTILIZADO</th><th>PLACA VEICULO</th>' +
                '<th>VALOR DO PEDAGIO</th><th>KM INICIAL</th><th>KM FINAL</th><th>TOTAL DE KM</th>' +
                '<th>HORARIO LOCAL DO AGENTE</th><th>HORARIO DO INICIO DA OPERAÇÃO</th><th>HORARIO DO TERMINO DA OPERAÇÃO</th>' +
                '<th>TOTAL DE HORAS DA OPERAÇÃO</th><th>TOTAL DE HORAS DO AGENTE</th>' +
                '</tr></thead><tbody>';

            examples.forEach(example => {
                const lines = example.split('\n').filter(line => line.trim());
                let data = {
                    modalidade: lines[0] || '',
                    empresa: lines[1] || '',
                    origem: '',
                    destino: '',
                    data: '',
                    horario: '',
                    motorista: '',
                    placa: '',
                    telefone: '',
                    agente1: '',
                    telefoneAgente1: '',
                    agente2: '',
                    telefoneAgente2: '',
                    veiculoUtilizado: '',
                    placaVeiculo: '',
                    valorPedagio: '',
                    kmInicial: '',
                    kmFinal: '',
                    totalKm: '',
                    horarioLocalAgente: '',
                    horarioInicio: '',
                    horarioTermino: '',
                    totalHorasOperacao: '',
                    totalHorasAgente: ''
                };

                lines.forEach((line, index) => {
                    if (index > 1) {
                        if (line.startsWith('Origem:')) data.origem = line.replace('Origem: ', '');
                        else if (line.startsWith('Destino:')) data.destino = line.replace('Destino: ', '');
                        else if (line.startsWith('Data:')) data.data = line.replace('Data: ', '');
                        else if (line.startsWith('Hora:') || line.startsWith('Horário:')) data.horario = line.replace(/Hora:|Horário:/, '').trim();
                        else if (line.startsWith('Motorista:')) data.motorista = line.replace('Motorista: ', '');
                        else if (line.startsWith('Placa:')) data.placa = line.replace('Placa: ', '');
                        else if (line.startsWith('Telefone:')) data.telefone = line.replace('Telefone: ', '');
                        else if (line.startsWith('Agente 1:')) {
                            // Tratamento para o primeiro agente
                            const agente1Data = line.replace('Agente 1: ', '').split(' e ');
                            data.agente1 = agente1Data[0] || '';
                            data.agente2 = agente1Data[1] || '';
                        }
                        else if (line.startsWith('Telefones do agente 1:')) {
                            const telefones = line.replace('Telefones do agente 1: ', '').split(' / ');
                            data.telefoneAgente1 = telefones[0] || '';
                            data.telefoneAgente2 = telefones[1] || '';
                        }
                        else if (line.startsWith('Veículo utilizado:')) data.veiculoUtilizado = line.replace('Veículo utilizado: ', '');
                        else if (line.startsWith('Placa:')) data.placaVeiculo = line.replace('Placa: ', '');
                        else if (line.startsWith('Valor do pedágio:')) data.valorPedagio = line.replace('Valor do pedágio: ', '');
                        else if (line.startsWith('Km inicial:')) data.kmInicial = line.replace('Km inicial: ', '');
                        else if (line.startsWith('Km final:')) data.kmFinal = line.replace('Km final: ', '');
                        else if (line.startsWith('Total de km:')) data.totalKm = line.replace('Total de km: ', '');
                        else if (line.startsWith('Horário local do agente:')) data.horarioLocalAgente = line.replace('Horário local do agente: ', '');
                        else if (line.startsWith('Horário de início da operação:')) data.horarioInicio = line.replace('Horário de início da operação: ', '');
                        else if (line.startsWith('Início:')) data.horarioInicio = line.replace('Início: ', '');
                        else if (line.startsWith('Horário de término da operação:')) data.horarioTermino = line.replace('Horário de término da operação: ', '');
                        else if (line.startsWith('Término:')) data.horarioTermino = line.replace('Término: ', '');
                        else if (line.startsWith('Total de horas da operação:')) data.totalHorasOperacao = line.replace('Total de horas da operação: ', '');
                        else if (line.startsWith('Total de horas do agente:')) data.totalHorasAgente = line.replace('Total de horas do agente: ', '');
                        else if (line.startsWith('Veículos a serem preservados:')) {
                            const vehicleData = lines[index + 1] || '';
                            if (vehicleData.includes('Motorista:')) {
                                data.motorista = vehicleData.replace('Motorista: ', '');
                            }
                            if (vehicleData.includes('Placa:')) {
                                data.placa = vehicleData.replace('Placa: ', '');
                            }
                        }
                    }
                });

                // Calcular Total de KM se não estiver presente
                if (data.kmInicial && data.kmFinal) {
                    const kmIni = parseInt(data.kmInicial);
                    const kmFim = parseInt(data.kmFinal);
                    if (!isNaN(kmIni) && !isNaN(kmFim)) {
                        data.totalKm = kmFim - kmIni; // Cálculo da diferença
                    }
                }

                tableHTML += `<tr>
                    <td>${data.modalidade}</td><td>${data.empresa}</td><td>${data.origem}</td><td>${data.destino}</td>
                    <td>${data.data}</td><td>${data.horario}</td><td>${data.motorista}</td><td>${data.placa}</td>
                    <td>${data.telefone}</td><td>${data.agente1}</td><td>${data.telefoneAgente1}</td>
                    <td>${data.agente2}</td><td>${data.telefoneAgente2}</td><td>${data.veiculoUtilizado}</td><td>${data.placaVeiculo || data.placa}</td>
                    <td>${data.valorPedagio}</td><td>${data.kmInicial}</td><td>${data.kmFinal}</td><td>${data.totalKm}</td>
                    <td>${data.horarioLocalAgente}</td><td>${data.horarioInicio}</td><td>${data.horarioTermino}</td>
                    <td>${data.totalHorasOperacao}</td><td>${data.totalHorasAgente}</td>
                </tr>`;
            });

            tableHTML += '</tbody></table>';
            document.getElementById('tableContainer').innerHTML = tableHTML;
        }

        function copyToClipboard() {
            const table = document.querySelector('table');
            if (!table) return alert('Gere a tabela primeiro!');

            let tsv = [];
            const rows = table.querySelectorAll('tr');
            rows.forEach(row => {
                const cols = row.querySelectorAll('td, th');
                const rowData = Array.from(cols).map(col => col.textContent).join('\t');
                tsv.push(rowData);
            });

            const tsvText = tsv.join('\n');
            navigator.clipboard.writeText(tsvText)
                .then(() => alert('Copiado para a área de transferência! Cole no Excel.'))
                .catch(err => alert('Erro ao copiar: ' + err));
        }
    </script>
</body>
</html>
